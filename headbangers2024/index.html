<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-PM7ZMMTJG2"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-PM7ZMMTJG2');
    </script>
    <title>Headbanger's boat 2024</title>
    <link rel="stylesheet" href="style.css?v1">
    
    <script type="module">
        
        import * as common from './common.js?v2';
        
        var day = 1;
        var yVenueHeight = 150;
        var yTopHeight = yVenueHeight;
        var yVenueBottom = yVenueHeight;
        var yEarliestBufferHours = 1;
        var yLatestBufferHours = 2;
        var fontVenue = 40 + 'px serif';
        var fontLeftTime = 35 + 'px serif';
        var fontCurrentTime = 40 + 'px serif';
        var fontGoingButton = 30 + 'px serif';
        var fontCloseButton = 35 + 'px serif';
        var fontSchedule = 35 + 'px serif';

        var xTimeOnLeftWidth = 100;

        var yTimeHourHeight = 400;
        var yTimePushLeftDown = 100;
        var secondsInAnHour = 60 * 60;
        var milliSecondsInAnHour = secondsInAnHour * 1000;

        var fullWidth = window.innerWidth;
        var xBlockWidth = (fullWidth - xTimeOnLeftWidth) / common.locations.length;
       
        var yHiddenButtonHeight = 1000;

        var colorVenueBack = 'darkgrey';
        var colorVenueFont = 'black';
        var colorCurrentTimeNumberBackground = 'black';
        var colorCurrentTimeNumber = 'white';
        var colorCurrentTimeLine = 'fuchsia';
        var colorLeftTimeLines = 'darkgrey';
        var colorLeftTimesNumber = 'cyan';
        var colorLeftTimesBackground = "hsla(0, 0%, 0%, 1)";
        var colorHiddenBackground = 'lightblue';
        var colorHiddenFont = 'black';
        var colorGoingButtonActiveBackground = "hsla(0, 0%, 90%, 1)";
        var colorGoingButtonNonActiveBackground = "hsla(0, 0%, 20%, 1)";
        var colorDayBackgroundInactive = 'grey';
        var colorDayBackgroundActive = 'gold';
        var colorGoToBackground = "grey";

        var colorEventBack = '#696969';
        var colorEventFont = 'lightgrey';
        
        // these need to be reset every redraw so don't initialize them here
        var eventNameToEvents;
        var dayToData;
        var bandToBandInfo;

        function primeBandToBandInfo()
        {
            bandToBandInfo = new Map();
            var bands = common.bandInfo;
            for (let i = 0; i < bands.length; i++) {
                let band = bands[i];
                bandToBandInfo.set(band[0], {genre: band[1]});
            }
            
        }

        function primeData() {
            eventNameToEvents = new Map();
            dayToData = new Map();
            primeBandToBandInfo();
            for (var dayIndex = 0; dayIndex < common.schedule.length; dayIndex++) {
                var currentEvents = common.schedule[dayIndex];
                var eventsSplit = currentEvents.split("\n");
                var events = [];
                var earliestStart = common.getDateTime("2100", "Jan", "1", "1:00", "AM");
                var latestEnd = common.getDateTime("2000", "Jan", "1", "1:00", "AM");
                var earliestEvent;
                var latestEvent;
                for (let i = 0; i < eventsSplit.length; i++) {

                    if (!eventsSplit[i] || eventsSplit[i].trim() == "") {
                        continue;
                    }
                    var eventWithDay = eventsSplit[i] + "," + (dayIndex + 1);
                    var event = common.getEventFromCommas(eventWithDay);

                    events.push(event);

                    var startTime = getStartDateTime(event);
                    if (startTime < earliestStart) {
                        earliestStart = startTime;
                        earliestEvent = event;
                    }

                    var endTime = getEndDateTime(event);
                    if (endTime > latestEnd) {
                        latestEnd = endTime;
                        latestEvent = event;
                    }
                    addToEventNameToEventsMap(event);

                }

                events.forEach(event => {
                    var eventStartDate = getStartDateTime(event);
                    var eventEndDate = getEndDateTime(event);
                    events.forEach(eventCompare => {
                        if (event.name != eventCompare.name)
                        {
                            var eventStartDateCompare = getStartDateTime(eventCompare);
                            var eventEndDateCompare = getEndDateTime(eventCompare);

                            if (eventStartDate < eventEndDateCompare && eventStartDateCompare < eventEndDate)
                            {
                                var goingInd = localStorage.getItem(common.getGoingKey(eventCompare));
                                if (goingInd == null) {
                                    goingInd = common.goingUndecided;
                                }
                            }
                        }
                    });
                });


                //remove minutes and add some buffer time
                var hourAndMinuteEarliest = earliestEvent.startTime.split(":");
                earliestStart = common.getDateTime(common.year, earliestEvent.startMonth, earliestEvent.startDay, (hourAndMinuteEarliest[0]) + ":00", earliestEvent.startAMPM)
                earliestStart = new Date(earliestStart.getTime() - (milliSecondsInAnHour * yEarliestBufferHours));
                var hourAndMinuteLatest = latestEvent.endTime.split(":");
                latestEnd = common.getDateTime(common.year, latestEvent.endMonth, latestEvent.endDay, (hourAndMinuteLatest[0]) + ":00", latestEvent.endAMPM)
                latestEnd = new Date(latestEnd.getTime() + (milliSecondsInAnHour * yLatestBufferHours));

                var data = {
                    earliestStart: earliestStart,
                    latestEnd: latestEnd,
                    events: events
                };
                dayToData.set((dayIndex + 1), data);
            }
        }

        function addToEventNameToEventsMap(event) {
            var events =eventNameToEvents.get(event.name);
            if (events == null) {
                events = [];
               eventNameToEvents.set(event.name, events);
            }
            events.push(event);
        }

        function redrawEverything() {
            console.log("refreshing");

            deleteEverything();

            primeData();

            var storedDay = localStorage.getItem(common.storedDayKey);

            if (storedDay == undefined || storedDay == "undefined" || isNaN(storedDay)) {
                day = Number(1);
            }
            else {
                day = Number(storedDay);
                if (day < 1 || day > 4) {
                    //somehow it was 0 once
                    day = 1;
                    localStorage.setItem(common.storedDayKey, 1);
                }
            }

            drawTimeline();
            buttons();
            drawTop();
            
            var scrollTo = localStorage.getItem(common.storedScrollToKey);
            if (scrollTo != "-1") {
                window.scroll(0, Number(scrollTo));
            }
            localStorage.setItem(common.storedScrollToKey, -1);
        }

        function deleteAll(element, tagName)
        {
            var elements = element.getElementsByTagName(tagName);
            while (elements.length > 0) {
                for (var i = 0; i < elements.length; i++) {
                    elements[i].remove();
                }
                elements = element.getElementsByTagName(tagName);
            }
        }

        function deleteEverything()
        {
            var schedule = document.getElementById("schedule");

            deleteAll(schedule, 'button');
            deleteAll(schedule, 'label');
            deleteAll(schedule, 'div');
            
            var top = document.getElementById('top');
            deleteAll(top, 'button');
            
        }

        
        function drawTop() {
            var top = document.getElementById('top');
            top.style.width = fullWidth;
            top.style.height = yTopHeight;
            
            var buttonTopLeft = document.createElement('button');
            buttonTopLeft.style.position = 'absolute';
            buttonTopLeft.style.left = 0 + 'px';

            buttonTopLeft.style.top = 0 + 'px';
            buttonTopLeft.style.width = xTimeOnLeftWidth;
            buttonTopLeft.style.height = yVenueHeight;
            //buttonTopLeft.style.backgroundImage = "url(images/hands.png)";
            buttonTopLeft.innerText = "TAP FOR INFO";
            buttonTopLeft.style.font = '35px serif';
            
            buttonTopLeft.style.color = "hsla(0, 0%, 80%, 1)";
            buttonTopLeft.style.backgroundColor = "hsla(0, 0%, 10%, 1)";
            buttonTopLeft.style.backgroundSize = 'cover';
            buttonTopLeft.style.backgroundPosition = 'center';
            buttonTopLeft.addEventListener("click", buttonTopLeftClick);

            top.appendChild(buttonTopLeft);

            for (var i = 0; i < common.locations.length; i++) {

                var buttonVenue = document.createElement('button');
                buttonVenue.style.position = 'absolute';
                buttonVenue.style.left = xTimeOnLeftWidth + (xBlockWidth * i) + 'px';

                buttonVenue.style.top = 0 + 'px';
                buttonVenue.style.width = xBlockWidth;
                buttonVenue.style.height = yVenueHeight;
                var venueText = common.locations[i].abbrev + ":" + getDelayMinutesForVenue(common.locations[i].abbrev) + "m " + common.locations[i].location;
                
                var buttonText = document.createElement("label");
                buttonText.innerText =venueText;
                buttonText.style.color = "red";
                buttonText.style.backgroundColor = "rgba(0, 0, 0, 0.8)"; // Set the background color of the text
                buttonVenue.appendChild(buttonText);

                buttonVenue.style.font = fontVenue;
                buttonVenue.style.backgroundColor = colorVenueBack;
                buttonVenue.style.color = colorVenueFont;
                buttonVenue.style.borderRadius = "12px";
                buttonVenue.style.zIndex = 10000000;
                buttonVenue.style.backgroundSize = 'cover';
                buttonVenue.style.backgroundPosition = 'center';
                //buttonVenue.innerText = venueText;
                buttonVenue.style.backgroundImage = "url(images/hands.png)";
                buttonVenue.addEventListener("click", venueClick);

                top.appendChild(buttonVenue);

            }
        }
        
        function buttonTopLeftClick() {
        	alert("-The venues, schedule, and bottom buttons all do things when tapped, so, tap stuff and see what it does.\n" +
              "-The current time will be drawn on the schedule, so tapping \"now\" will go to that when the shows start.\n" +
              "-Need data for this to work onboard.  All the going statuses may suddenly reset.  I may break it at any point.  No guarantees on this site's reliability, basically.\n");
        }

        function venueClick(venueClicked) {

            var venueAbbrev = venueClicked.target.textContent.split(":")[0];
            var venue;
            for (var i = 0; i < common.locations.length; i++) {
                if (common.locations[i].abbrev == venueAbbrev)
                {
                    venue = common.locations[i];
                    break;
                }
            }

            var note = "";
            if (venue.note != "" && venue.note != undefined)
            {
                note += ". " + venue.note;
            }

            let delayStr = prompt("Minutes delayed for " + venue.fullName + " day " + day + note, getDelayMinutesForVenue(venue));
            if (delayStr == null || "" == delayStr) {
                return;
            }
            let delay = parseInt(delayStr);
            if (Number.isNaN(delay)) {
                alert(delayStr + " is not a number");
                return;
            }
            localStorage.setItem(getDelayKey(venue.abbrev), delay);
            redrawEverything();
        }

        function getDelayKey(venue) {
            return common.storedDelayKey + day + venue;
        }

        function getDelayMinutesForVenue(venue) {
            var delayMinutes = localStorage.getItem(getDelayKey(venue));
            if (delayMinutes == null) {
                return 0;
            }
            return delayMinutes;
        }

        function drawTimeline() {
            var data = dayToData.get(day);
            var schedule = document.getElementById("schedule");

            var height = getYPixelLocation(data.earliestStart, data.latestEnd);
            schedule.style.height = getYPixelLocation(data.earliestStart, data.latestEnd) + "px";

            drawTimeOnLeft(data.earliestStart, data.latestEnd);
            drawCurrentTime(data.earliestStart);
            drawEventsSchedule(data.events, data.earliestStart);

        }

        function drawCurrentTime(earliestStart) {

            var schedule = document.getElementById("schedule");
            var currentTime = new Date();    
            
            if (currentTime > common.storedTimeTEST)
            {
                common.storedTimeTEST = currentTime;
            }
            var pixel = getYPixelLocation(earliestStart, common.storedTimeTEST);

            var labelCurrentTimeNumber = document.createElement('label');
            labelCurrentTimeNumber.style.position = 'absolute';
            labelCurrentTimeNumber.style.left = 0 + 'px';

            labelCurrentTimeNumber.style.top = (pixel + yTimePushLeftDown) + 'px';
            labelCurrentTimeNumber.style.width = xBlockWidth;
            labelCurrentTimeNumber.style.height = yTimeHourHeight;
            var minutes = common.storedTimeTEST.getMinutes();
            var minutesString;
            if (minutes < 10) {
                minutesString = "0" + minutes;
            }
            else {
                minutesString = minutes;
            }
            var hours = common.storedTimeTEST.getHours();
            var hoursString;
            if (hours > 12) {
                hoursString = hours - 12;
            }
                else if (hours == 0) {
                hoursString = 12;
            }
            else {
                hoursString = hours;
            }

            labelCurrentTimeNumber.textContent = hoursString + ":" + minutesString;
            labelCurrentTimeNumber.style.font = fontCurrentTime;
            labelCurrentTimeNumber.style.background = colorCurrentTimeNumberBackground;
            labelCurrentTimeNumber.style.color = colorCurrentTimeNumber;
            labelCurrentTimeNumber.style.height = 50;
            labelCurrentTimeNumber.style.width = xTimeOnLeftWidth;

            schedule.appendChild(labelCurrentTimeNumber);

            var labelCurentTimeLine = document.createElement('label');
            labelCurentTimeLine.style.position = 'absolute';
            labelCurentTimeLine.style.left = 0 + 'px';

            labelCurentTimeLine.style.top = (pixel + yTimePushLeftDown) + 'px';
            labelCurentTimeLine.style.width = fullWidth;
            labelCurentTimeLine.style.height = 5;
            labelCurentTimeLine.style.background = colorCurrentTimeLine;

            schedule.appendChild(labelCurentTimeLine);
        }

        function getStartDateTime(event) {
            return common.getDateTime(common.year, event.startMonth, event.startDay, event.startTime, event.startAMPM);
        }
        function getEndDateTime(event) {
            return common.getDateTime(common.year, event.endMonth, event.endDay, event.endTime, event.endAMPM);
        }

        function drawTimeOnLeft(earliestStart, latestEnd) {
            var schedule = document.getElementById("schedule");
            
            var startMinutes = earliestStart.getMinutes();

            var drawingTime = earliestStart;
            while (drawingTime < latestEnd) {
                var yPixelLocation = getYPixelLocation(earliestStart, drawingTime);

                var labelLeftTimes = document.createElement('label');
                labelLeftTimes.style.position = 'absolute';
                labelLeftTimes.style.left = 0 + 'px';

                labelLeftTimes.style.top = (yPixelLocation + yTimePushLeftDown) + 'px';
                labelLeftTimes.style.width = xTimeOnLeftWidth;
                labelLeftTimes.style.height = yTimeHourHeight;
                var startMinutesString;
                if (startMinutes < 10) {
                    startMinutesString = "0" + startMinutes;
                }
                else {
                    startMinutesString = startMinutes;
                }

                var hourString;
                var ampm = "AM";
                var drawingHour = drawingTime.getHours();
                //TODO clean this up
                if (drawingHour > 12) {
                    hourString = drawingHour - 12;
                    if (drawingHour == 24) {
                        ampm = "AM";
                        hourString = 12;
                    }
                    else {
                        ampm = "PM";
                    }
                }
                else {
                    if (drawingHour == 12) {
                        ampm = "PM";
                        hourString = drawingHour;
                    }
                    else {
                        ampm = "AM";
                        hourString = drawingHour;
                    }
                    if (drawingHour == 0) {
                        hourString = 12;
                    }
                }

                labelLeftTimes.textContent = hourString + ampm;
                labelLeftTimes.style.font = fontLeftTime;
                labelLeftTimes.style.backgroundColor = colorLeftTimesBackground;
                labelLeftTimes.style.color = colorLeftTimesNumber;
                labelLeftTimes.style.textShadow = "2px 2px 0px black";

                schedule.appendChild(labelLeftTimes);

                //draw line
                var labelLeftTimeLine = document.createElement('label');
                labelLeftTimeLine.style.position = 'absolute';
                labelLeftTimeLine.style.left = 0 + 'px';

                labelLeftTimeLine.style.top = (yPixelLocation + yTimePushLeftDown) + 'px';
                labelLeftTimeLine.style.width = fullWidth;
                labelLeftTimeLine.style.height = 5;
                labelLeftTimeLine.style.backgroundColor = colorLeftTimeLines;

                schedule.appendChild(labelLeftTimeLine);
                drawingTime = new Date(drawingTime.getTime() + milliSecondsInAnHour);
            }

        }

        function getYPixelLocation(earliestStart, time) {
            var hoursPast = (time.getTime() - earliestStart.getTime()) / milliSecondsInAnHour;
            var pixel = (yTimeHourHeight * hoursPast);
            return Number(pixel);
        }

        function drawEventsSchedule(events, earliestStart) {

            drawFaceupSchedule(events, earliestStart);
            drawHiddenOverlay(events, earliestStart);
        }

        function drawFaceupSchedule(events, earliestStart) {
            var schedule = document.getElementById("schedule");
            for (let i = 0; i < events.length; i++) {
                var event = events[i];

                var buttonViewable = document.createElement('button');
                buttonViewable.style.borderRadius = "12px";

                buttonViewable.style.position = 'absolute';
                buttonViewable.style.left = xTimeOnLeftWidth + 'px';
                var location = event.location;

                var startDate = new Date(getStartDateTime(event).getTime() + (1000 * 60 * getDelayMinutesForVenue(location)));
                var yPixelTop = getYPixelLocation(earliestStart, startDate);
                //TODO where is the 105 from?
                buttonViewable.style.top = (yPixelTop + 105) + 'px';
                buttonViewable.style.left = getXPixelForLocation(event);
                buttonViewable.style.width = xBlockWidth;
                var endDate = new Date(getEndDateTime(event).getTime() + (1000 * 60 * getDelayMinutesForVenue(location)));

                var height = getYPixelLocation(earliestStart, endDate) - yPixelTop;
                buttonViewable.style.height = height + 'px';
                buttonViewable.style.font = fontSchedule;
                
                buttonViewable.addEventListener("click", eventClick);
                buttonViewable.id = getScheduleViewableButtonId(event);
                buttonViewable.style.textAlign = "left";
                buttonViewable.style.paddingLeft = "15px";
                //third one to make grey
                buttonViewable.style.backgroundColor = "hsla(0, 0%, 20%, 1)";
                buttonViewable.style.color = "white";
                buttonViewable.style.textShadow = "2px 2px 0px black";
                buttonViewable.style.backgroundSize = 'cover';
                buttonViewable.style.backgroundPosition = 'center';
                buttonViewable.style.backgroundImage = "url(images/dog.png)";
                
                var bandInfo = bandToBandInfo.get(event.name);
                var genreText = "";
                if (bandInfo != null && bandInfo != "undefined")
                {
                    genreText = bandInfo.genre + "\n";
                }
                var goingInd = localStorage.getItem(common.getGoingKey(event));
                if (goingInd == null) {
                    goingInd = common.goingUndecided;
                }
                var text = event.name + "\n"  + genreText + getTimeString(startDate) + "-" + getTimeString(endDate) + "\n" + goingInd;
                var buttonLabel = document.createElement("label");
                buttonLabel.innerText = text;
                //TODO wonder if making this id the same as the button is bad, but the click uses the id of the thing that was clicked to pick which overlay to show 
                buttonLabel.id = getScheduleViewableButtonId(event);
                buttonLabel.style.color = "white";
                buttonLabel.style.backgroundColor = "rgba(0, 0, 0, 1)"; // Set the background color of the text
                buttonViewable.appendChild(buttonLabel);
                //buttonViewable.innerText = text;

                var leftPortion = document.createElement("span");
                leftPortion.style.position = "absolute";
                leftPortion.style.top = "0";
                leftPortion.style.left = "0";
                leftPortion.style.width = "10px";
                leftPortion.style.height = "100%";
                leftPortion.style.backgroundSize = "10px 10px";

                if (goingInd == common.goingGoing)
                {
                    leftPortion.style.backgroundColor = "limegreen";
                    //buttonLabel.style.color = "limegreen";
                    buttonViewable.style.opacity = "1";
                }
                else if (goingInd == common.goingNotGoing)
                {
                    leftPortion.style.backgroundColor = "hsla(0, 100%, 25%, 1)";
                    buttonViewable.style.opacity = ".2";
                }
                else if (goingInd == common.goingMaybe)
                {
                    leftPortion.style.backgroundImage = "repeating-linear-gradient(-45deg, limegreen, limegreen 5px, black 5px, black 10px)"; // Striped pattern
                    buttonViewable.style.opacity = ".8";
                }
                else{
                    //TBD
                    leftPortion.style.backgroundColor = "hsla(240, 100%, 15%, 1)";
                    buttonViewable.style.opacity = ".7";
                }

                buttonViewable.appendChild(leftPortion);
                schedule.appendChild(buttonViewable);

            }
        }

        function getScheduleViewableButtonId(event) {
            return event.id + ",scheduleViewableButton";
        }

        function getTimeString(date) {
            var hour = date.getHours();
            if (hour > 12) {
                hour -= 12;
            }
            if (hour == 0)
            {
                hour = 12;
            }
            var minute = date.getMinutes();
            var minuteString = "";
            if (minute < 10) {
                minuteString += "0";
            }
            minuteString += minute;
            return hour + ":" + minuteString;
        }

        function drawHiddenOverlay(events, earliestStart) {
            var schedule = document.getElementById("schedule");
            for (let i = 0; i < events.length; i++) {
                var event = events[i];
                var location = event.location;
                var startDate = new Date(getStartDateTime(event).getTime() + (1000 * 60 * getDelayMinutesForVenue(location)));

                var yPixelTop = getYPixelLocation(earliestStart, startDate);
                
                var endDate = new Date(getStartDateTime(event).getTime() + (1000 * 60 * getDelayMinutesForVenue(location)));

                var height = getYPixelLocation(earliestStart, getEndDateTime(endDate)) - yPixelTop;

                var labelHidden = document.createElement('label');
                labelHidden.style.position = 'absolute';
                labelHidden.style.left = xTimeOnLeftWidth + 'px';

                labelHidden.style.top = (yPixelTop) + 'px';
                labelHidden.style.left = 0;
                labelHidden.style.width = "100%";
                labelHidden.style.height = yHiddenButtonHeight + 'px';
                labelHidden.style.font = "40px serif";
                labelHidden.style.backgroundColor = "hsla(0, 0%, 10%, .8)";
                labelHidden.style.color = "lightblue";
                labelHidden.style.visibility = 'hidden';
                labelHidden.id = getScheduleHiddenEventId(event);
                labelHidden.style.zIndex = 100000;

                var weirdButtonFix = document.createElement('button');
                weirdButtonFix.style.width = 0 + 'px';
                weirdButtonFix.style.height = 0 + 'px';
                weirdButtonFix.style.visibility = 'hidden';
                weirdButtonFix.style.bottom = "0";
                weirdButtonFix.style.position = "absolute";

                //TODO for some reason the label activates on the first button added
                labelHidden.appendChild(weirdButtonFix);

                schedule.appendChild(labelHidden);

                var labelBand = document.createElement('label');
                var conflicts = event.overlap.trim();
                if (conflicts == "")
                {
                    conflicts = "None.";
                }
                labelBand.innerText = event.name + "\n" + event.startTime + "-" + event.endTime + " " + event.endAMPM + "\n" + "Conflicts: " + conflicts;
                labelHidden.appendChild(labelBand);
                labelHidden.appendChild(document.createElement('div'));


                var buttonGoingUndecided = createButtonGoing(common.goingUndecided, schedule, event);
                var buttonGoingMaybe = createButtonGoing(common.goingMaybe, schedule, event);
                var buttonGoingGoing = createButtonGoing(common.goingGoing, schedule, event);
                var buttonGoingNotGoing = createButtonGoing(common.goingNotGoing, schedule, event);

                labelHidden.appendChild(buttonGoingGoing);
                labelHidden.appendChild(buttonGoingNotGoing);
                labelHidden.appendChild(buttonGoingMaybe);
                labelHidden.appendChild(buttonGoingUndecided);

                labelHidden.appendChild(document.createElement('div'));

                var buttonCloseOnLabel = document.createElement('button');
                buttonCloseOnLabel.style.borderRadius = "12px";
                buttonCloseOnLabel.style.width = "20%";
                buttonCloseOnLabel.style.height = 100 + 'px';
                buttonCloseOnLabel.innerText = 'close';
                var closeId = getCloseButtonId(event);
                buttonCloseOnLabel.id = closeId;
                //buttonCloseOnLabel.style.bottom = "0";
                buttonCloseOnLabel.style.position = "absolute";
                buttonCloseOnLabel.style.font = fontCloseButton;
                buttonCloseOnLabel.style.top = 0;
                buttonCloseOnLabel.style.right = 0;
                buttonCloseOnLabel.style.opacity = ".7";
                buttonCloseOnLabel.style.backgroundColor = "hsla(0, 0%, 90%, 1)";

                buttonCloseOnLabel.addEventListener("click", closeHiddenLabel);
                labelHidden.appendChild(document.createElement('div'));

                labelHidden.appendChild(buttonCloseOnLabel);
                labelHidden.appendChild(document.createElement('div'));
                var alsoLabel = document.createElement('label');
                //TODO divs don't appear to do what I want
                alsoLabel.innerText = "\n\n\nAlso:";
                labelHidden.appendChild(alsoLabel);

                var eventsAll = eventNameToEvents.get(event.name);
                eventsAll.forEach(eventIter => {
                    if (eventIter.id == event.id) {
                        return;
                    }
                    labelHidden.appendChild(document.createElement('div'));

                    var labelBandAlso = document.createElement('label');

                    var conflicts = eventIter.overlap.trim();
                    if (conflicts == "")
                    {
                        conflicts = "None.";
                    }
                    labelBandAlso.innerText = "Day: " + eventIter.day + " " + " " + eventIter.startTime + "-" + eventIter.endTime + " " + eventIter.endAMPM + "\n" + "Conflicts: " + conflicts;
                    labelHidden.appendChild(labelBandAlso);
                    labelHidden.appendChild(document.createElement('div'));
                    var buttonGoingGoing = createButtonGoing(common.goingGoing, schedule, eventIter);
                    var buttonGoingUndecided = createButtonGoing(common.goingUndecided, schedule, eventIter);
                    var buttonGoingMaybe = createButtonGoing(common.goingMaybe, schedule, eventIter);
                    var buttonGoingNotGoing = createButtonGoing(common.goingNotGoing, schedule, eventIter);

                    labelHidden.appendChild(buttonGoingGoing);
                    labelHidden.appendChild(buttonGoingNotGoing);
                    labelHidden.appendChild(buttonGoingMaybe);
                    labelHidden.appendChild(buttonGoingUndecided);
                    
                    var buttonGoTo = createButtonGoTo(eventIter, schedule);
                    labelHidden.appendChild(buttonGoTo);

                });
            }
        }

        function getCloseButtonId(event) {
            return event.id + ",hiddenClose";
        }
        function getScheduleHiddenEventId(event) {
            return event.id + ",scheduleHidden";
        }

        function createButtonGoTo(event, schedule) {
            var buttonGoTo = document.createElement('button');
            buttonGoTo.style.backgroundColor = colorGoToBackground;

            buttonGoTo.style.width = "20%";
            buttonGoTo.style.height = 100;
            buttonGoTo.innerText = "Go";
            buttonGoTo.id = getGoToKey(event);
            buttonGoTo.style.font = fontGoingButton;

            buttonGoTo.addEventListener("click", goToClick);

            return buttonGoTo;
        }

        function getGoToKey(event) {
            return event.id + ",goto";
        }

        function goToClick(event) {
            var eventObject = common.getEventFromCommas(event.target.id);
            var day = eventObject.day;
            localStorage.setItem(common.storedDayKey, eventObject.day);

            var earliestStart = dayToData.get(Number(day)).earliestStart;
            var time = getStartDateTime(eventObject);

            var scrollToLocation = getYPixelLocation(earliestStart, time);
            localStorage.setItem(common.storedScrollToKey, scrollToLocation - 200);

            var parentLabel = event.target.parentElement;
            var label = common.getEventFromCommas(parentLabel.id);
            hideLabel(label);
            redrawEverything();
        }

        function noop(e) {
            e.stopPropagation();
        }

        function createButtonGoing(going, schedule, event) {

            var buttonGoingOnLabel = document.createElement('button');
            buttonGoingOnLabel.style.borderRadius = "12px";

            var goingInd = localStorage.getItem(common.getGoingKey(event));
            if (goingInd == null) {
                goingInd = common.goingUndecided;
                localStorage.setItem(common.getGoingKey(event), goingInd);
            }
            if (goingInd == going) {
                buttonGoingOnLabel.style.backgroundColor = colorGoingButtonActiveBackground;
            }
            else {
                buttonGoingOnLabel.style.backgroundColor = colorGoingButtonNonActiveBackground;
            }

            buttonGoingOnLabel.style.width = "20%";
            buttonGoingOnLabel.style.height = 100;
            buttonGoingOnLabel.innerText = going;
            buttonGoingOnLabel.id = common.getGoingKey(event);
            buttonGoingOnLabel.style.font = fontGoingButton;
            buttonGoingOnLabel.style.opacity = ".7";

            buttonGoingOnLabel.addEventListener("click", goingClick);

            return buttonGoingOnLabel;
        }

        function goingClick(theclick) {

            var schedule = document.getElementById("schedule");
            var parentLabel = theclick.target.parentElement;

            var id = theclick.target.id;
            var innerText = theclick.target.innerText;
            localStorage.setItem(id, innerText);

            const buttonsOnLabel = parentLabel.querySelectorAll("button");
            buttonsOnLabel.forEach(buttonGoingOnLabel => {
                var goingInd = localStorage.getItem(buttonGoingOnLabel.id);
                if (goingInd == null) {
                    if (buttonGoingOnLabel.innerText != "close" && buttonGoingOnLabel.innerText != "Go"){
                        buttonGoingOnLabel.style.backgroundColor = colorGoingButtonNonActiveBackground;
                    }
                }
                else {
                    if (buttonGoingOnLabel.innerText == goingInd) {
                        //this is if the text of the button is the same as the stored going indication
                        buttonGoingOnLabel.style.backgroundColor = colorGoingButtonActiveBackground;
                    }
                    else{
                        buttonGoingOnLabel.style.backgroundColor = colorGoingButtonNonActiveBackground;
                    }
                }

            });

        }

        function hideLabel(event) {
            
            var labelHidden = document.getElementById(getScheduleHiddenEventId(event));
            labelHidden.style.visibility = 'hidden';
        }

        function closeHiddenLabel(event) {

            var eventId = event.target.id;
            var theEvent = common.getEventFromCommas(event.target.id);
            hideLabel(theEvent);
            redrawEverything();

        }

        function eventClick(event) {
            var id = event.target.id;
            var eventWithValues = common.getEventFromCommas(id);
            var labelHidden = document.getElementById(getScheduleHiddenEventId(eventWithValues));
            labelHidden.style.visibility = 'visible';
        }

        function getXPixelForLocation(event) {
            var locationIndex = getLocationIndex(event.location);

            var left = (locationIndex * xBlockWidth) + xTimeOnLeftWidth;
            return left;
        }

        function getLocationIndex(location) {
            for (let i = 0; i < common.locations.length; i++) {
                if (location === common.locations[i].abbrev) {
                    return i;
                }
            }
        }

        function handleDayButton(newDay) {
            if (newDay != day) {
                day = newDay;
                localStorage.setItem(common.storedDayKey, day);
                redrawEverything();
            }
        }

        function buttons() {
            
            resetButton("dayButton1", "29M");
            resetButton("dayButton2", "29T");
            resetButton("dayButton3", "30W");
            resetButton("dayButton4", "31R");

            document.getElementById("dayButton" + day).style.backgroundColor = colorDayBackgroundActive;
            document.getElementById("dayButton" + day).style.backgroundImage = "url(images/dude.png)";
            
            var buttonWidth = Math.floor(fullWidth / 7) + "px";
            document.getElementById("dayButton1").style.width = buttonWidth;
            document.getElementById("dayButton2").style.width = buttonWidth;
            document.getElementById("dayButton3").style.width = buttonWidth;
            document.getElementById("dayButton4").style.width = buttonWidth;
        }

        function resetButton(buttonName, buttonText)
        {
            var button = document.getElementById(buttonName);
            button.delete
            deleteAll(button, 'label');
            
            button.style.backgroundImage = "url(images/hands.png)";
            button.style.backgroundSize = 'cover';
            button.style.backgroundPosition = 'center';

            var buttonLabel = document.createElement("label");
            buttonLabel.innerText = buttonText;
            buttonLabel.style.color = "red";
            buttonLabel.style.backgroundColor = "rgba(0, 0, 0, 0.8)"; // Set the background color of the text
            button.appendChild(buttonLabel);
        }

        function goToNow() {
            for (var day = 1; day <= 4; day++) {
                var data = dayToData.get(day);
                if (data.earliestStart < common.storedTimeTEST && data.latestEnd > common.storedTimeTEST) {
                    localStorage.setItem(common.storedDayKey, day);

                    var scrollToLocation = getYPixelLocation(data.earliestStart, common.storedTimeTEST);
                    
                    localStorage.setItem(common.storedScrollToKey, scrollToLocation - 200);
                    redrawEverything();
                    return;
                }
            }
        }

        function alphaToggle() {
            window.location.assign("./alpha.html");
        }
        window.redrawEverything = redrawEverything;
        window.handleDayButton = handleDayButton;
        window.alphaToggle = alphaToggle;
        window.goToNow = goToNow;

    </script>

</head>

<body onload="redrawEverything(); setInterval('redrawEverything()', 120000);">
    <div class="top" id="top">
    </div>

    <div class="schedule" id="schedule"></div>
 
    <div class="bottom" id="bottom">
        <button type="button" onclick="handleDayButton(1)" id="dayButton1" class="button"></button>
        <button type="button" onclick="handleDayButton(2)" id="dayButton2" class="button"></button>
        <button type="button" onclick="handleDayButton(3)" id="dayButton3" class="button"></button>
        <button type="button" onclick="handleDayButton(4)" id="dayButton4" class="button"></button>
        <button type="button" onclick="goToNow()" id="goToNow" class="button"
            style="background-image: url(images/pinklady.png); background-size: cover; background-position: center; text-align: left">
            <label style="background-color:  rgba(0, 0, 0, 0.8); color: red">Now
            </label>
        </button>
        <button type="button" onclick="alphaToggle()" id="alphaToggle" class="button"
            style="background-image: url(images/pinklady.png); background-size: cover; background-position: center; text-align: left">
            <label style="background-color:  rgba(0, 0, 0, 0.8); color: red">List
            </label>
        </button>
    </div>

</body>

</html>
